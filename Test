@Test
void testFilterPlans_WithMatchingPlans() {
    // Mock input
    Map<String, String> preAuthHeadersMap = Map.of(
        "UC_VENDOR_ID", "SPSRWB",
        "UC_PLAN_ID_LIST", "plan1,plan2"
    );
    String clientId = "client123";

    // Create sample DocumentInfo and MailInfo
    DocumentInfo doc1 = new DocumentInfo("plan1"); // Matches UC_PLAN_ID_LIST
    DocumentInfo doc2 = new DocumentInfo("plan3"); // Doesn't match
    MailInfo mailInfo = new MailInfo(List.of(doc1, doc2));
    List<MailInfo> mailInfoList = List.of(mailInfo);

    // Call the method
    List<MailInfo> result = service.filterPlans(mailInfoList, preAuthHeadersMap, clientId);

    // Assertions
    assertNotNull(result);
    assertEquals(1, result.size()); // One MailInfo remains
    assertEquals(1, result.get(0).getDocumentInfo().size()); // Only one DocumentInfo remains
    assertEquals("plan1", result.get(0).getDocumentInfo().get(0).getPlanId());
}

@Test
void testFilterPlans_WithEmptyHeaders() {
    // Mock input
    Map<String, String> preAuthHeadersMap = Collections.emptyMap();
    String clientId = "client123";

    // Create sample DocumentInfo and MailInfo
    DocumentInfo doc1 = new DocumentInfo("plan1");
    DocumentInfo doc2 = new DocumentInfo("plan2");
    MailInfo mailInfo = new MailInfo(List.of(doc1, doc2));
    List<MailInfo> mailInfoList = List.of(mailInfo);

    // Call the method
    List<MailInfo> result = service.filterPlans(mailInfoList, preAuthHeadersMap, clientId);

    // Assertions
    assertNotNull(result);
    assertEquals(mailInfoList, result); // Original list is returned
}
