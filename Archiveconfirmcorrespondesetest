@ExtendWith(MockitoExtension.class)
class CorrespondenceControllerTest {

    @Mock
    private CorrespondenceService correspondenceService;

    @Mock
    private MailDocumentService mailDocumentService;

    @InjectMocks
    private CorrespondenceController correspondenceController;

    @Test
    void testGetCorrespondenceDoc_withNullHeaders() {
        // Execute & Verify
        Exception exception = assertThrows(NullPointerException.class, () -> {
            correspondenceController.getCorrespondenceDoc(null);
        });

        assertEquals("httpHeaders is marked non-null but is null", exception.getMessage());
    }

    @Test
    void testGetCorrespondenceDoc_withValidHeaders() {
        // Mock input
        HttpHeaders httpHeaders = new HttpHeaders();
        httpHeaders.add("Authorization", "Bearer token");

        // Create mock lists
        List<MailInfo> mailInfos = List.of(new MailInfo("mailId", "mailSubject", "mailBody"));
        List<ComboCorresInfo> comboCorresInfos = List.of(new ComboCorresInfo("comboId", "comboDetails"));
        List<ArchiveDocsInfo> archiveDocsInfos = List.of(new ArchiveDocsInfo("archiveId", "archiveDetails"));

        // Build a mock CorrespondenceResponse
        CorrespondenceResponse mockResponse = CorrespondenceResponse.builder()
                .mailInfos(mailInfos)
                .comboCorresInfos(comboCorresInfos)
                .archiveDocsInfos(archiveDocsInfos)
                .correspondenceText("Sample Correspondence")
                .usePlanLvlBrand(true)
                .statementBulletPoints("Sample Bullet Points")
                .confirmSourceType(ConfirmSourceType.MANUAL)
                .build();

        when(correspondenceService.getCorrespondenceDocs(httpHeaders.toSingleValueMap())).thenReturn(mockResponse);

        // Execute
        CorrespondenceResponse response = correspondenceController.getCorrespondenceDoc(httpHeaders);

        // Verify
        assertNotNull(response);
        assertEquals(mockResponse, response);
        verify(correspondenceService).getCorrespondenceDocs(httpHeaders.toSingleValueMap());
    }

    @Test
    void testGetDocumentData_withNullMessageId() {
        // Execute & Verify
        Exception exception = assertThrows(IllegalArgumentException.class, () -> {
            correspondenceController.getDocumentData(null, "docId");
        });

        assertEquals("messageId must not be null", exception.getMessage());
    }

    @Test
    void testGetDocumentData_withNullDocumentId() {
        // Execute & Verify
        Exception exception = assertThrows(IllegalArgumentException.class, () -> {
            correspondenceController.getDocumentData("msgId", null);
        });

        assertEquals("documentId must not be null", exception.getMessage());
    }

    @Test
    void testGetDocumentData_withValidInputs() throws IOException {
        // Mock input
        String messageId = "12345";
        String documentId = "67890";

        // Create a mock DocumentData object
        DocumentData mockDocumentData = new DocumentData("dataId", "contentType", new byte[0]);

        // Mock behavior
        when(mailDocumentService.getDocument(messageId, documentId)).thenReturn(mockDocumentData);

        // Execute
        DocumentData response = correspondenceController.getDocumentData(messageId, documentId);

        // Verify
        assertNotNull(response);
        assertEquals(mockDocumentData, response);
        verify(mailDocumentService).getDocument(messageId, documentId);
    }

    @Test
    void testGetDocumentData_throwsIOException() throws IOException {
        // Mock input
        String messageId = "12345";
        String documentId = "67890";

        // Mock behavior
        when(mailDocumentService.getDocument(messageId, documentId)).thenThrow(new IOException("Test exception"));

        // Execute & Verify
        Exception exception = assertThrows(IOException.class, () -> {
            correspondenceController.getDocumentData(messageId, documentId);
        });

        assertEquals("Test exception", exception.getMessage());
        verify(mailDocumentService).getDocument(messageId, documentId);
    }
}
