import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.MockitoAnnotations;

import java.util.*;

import static org.junit.jupiter.api.Assertions.*;
import static org.mockito.Mockito.*;

class MailItConfirmCorrespondenceServiceTest {

    @Mock
    private MailItPreferenceService mailItPreferenceService;

    @Mock
    private RequestService requestService;

    @Mock
    private ClientParticipantInfoCache clientParticipantInfoCache;

    @Mock
    private SetItPullClientCache setItPullClientCache;

    @InjectMocks
    private MailItConfirmCorrespondenceService service;

    @BeforeEach
    void setUp() {
        MockitoAnnotations.openMocks(this);
    }

    @Test
    void testGetCorrespondenceDocs_WithValidInputs_ReturnsResponse() {
        // Mock inputs
        Map<String, String> headersMap = Map.of("Authorization", "Bearer token");
        PartyInfo partyInfo = new PartyInfo("partyId", "clientId", "ssn");

        Party party = Party.builder().partyId("partyId").pptId("ssn").build();
        List<Account> accountsList = List.of(new Account("plan1", "SAVINGS", true));

        List<String> planList = List.of("plan1");
        MailFolder mailFolder = new MailFolder();
        mailFolder.setMailInfo(Collections.emptyList());

        // Mock behavior
        when(requestService.getPreAuthHeadersMap(headersMap)).thenReturn(headersMap);
        when(requestService.getAccountsList(party, headersMap)).thenReturn(accountsList);
        when(mailItPreferenceService.getCombinedMailFolder("clientId", "ssn", planList, DocumentType.CONFIRM, DocumentType.EDELIVERYUPDATE))
                .thenReturn(mailFolder);

        // Call method
        CorrespondenceResponse response = service.getCorrespondenceDocs(headersMap, partyInfo);

        // Assertions
        assertNotNull(response);
        assertNull(response.getMailInfos());
    }

    @Test
    void testSetPlanLvlBrandFlg_WithPlansAndBrandingEnabled_ReturnsTrue() {
        // Mock inputs
        PartyInfo partyInfo = new PartyInfo("partyId", "clientId", "ssn");
        List<String> planList = List.of("plan1");
        Plan plan = Plan.builder().planId("plan1").clientId("clientId").build();
        PlanGeneralInfo planGeneralInfo = new PlanGeneralInfo();
        planGeneralInfo.setUsePlanLevelCustomBranding("Y");

        // Mock behavior
        when(clientParticipantInfoCache.getAllPlansByClientParticipantControlType("clientId", "ssn", ControlType.WEB))
                .thenReturn(planList);
        when(setItPullClientCache.getSetItPlanGeneralInfo(plan)).thenReturn(planGeneralInfo);

        // Call method
        boolean result = service.setPlanLvlBrandFlg(partyInfo);

        // Assertions
        assertTrue(result);
    }

    @Test
    void testSetPlanLvlBrandFlg_WithNoPlans_ReturnsFalse() {
        // Mock inputs
        PartyInfo partyInfo = new PartyInfo("partyId", "clientId", "ssn");

        // Mock behavior
        when(clientParticipantInfoCache.getAllPlansByClientParticipantControlType("clientId", "ssn", ControlType.WEB))
                .thenReturn(Collections.emptyList());

        // Call method
        boolean result = service.setPlanLvlBrandFlg(partyInfo);

        // Assertions
        assertFalse(result);
    }

    @Test
    void testFilterPlans_WithMatchingPlans_ReturnsFilteredDocuments() {
        // Mock inputs
        Map<String, String> preAuthHeadersMap = Map.of(CrspConstants.UC_VENDOR_ID, CrspConstants.SPSRWB,
                CrspConstants.UC_PLAN_ID_LIST, "plan1,plan2");
        String clientId = "clientId";
        List<MailInfo> mailInfoList = List.of(new MailInfo(List.of(new DocumentInfo("plan1"))));

        // Call method
        List<MailInfo> result = service.filterPlans(mailInfoList, preAuthHeadersMap, clientId);

        // Assertions
        assertNotNull(result);
        assertEquals(1, result.size());
        assertEquals("plan1", result.get(0).getDocumentInfo().get(0).getPlanId());
    }

    @Test
    void testFilterPlans_WithNoMatchingPlans_ReturnsEmptyList() {
        // Mock inputs
        Map<String, String> preAuthHeadersMap = Map.of(CrspConstants.UC_VENDOR_ID, CrspConstants.SPSRWB,
                CrspConstants.UC_PLAN_ID_LIST, "plan3");
        String clientId = "clientId";
        List<MailInfo> mailInfoList = List.of(new MailInfo(List.of(new DocumentInfo("plan1"))));

        // Call method
        List<MailInfo> result = service.filterPlans(mailInfoList, preAuthHeadersMap, clientId);

        // Assertions
        assertNotNull(result);
        assertTrue(result.isEmpty());
    }
}
